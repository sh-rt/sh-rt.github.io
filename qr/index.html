<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ê³ ê¸‰ QR ì½”ë“œ ìƒì„±ê¸°</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
      max-width: 700px;
      margin: 50px auto;
      padding: 20px;
      background-color: #f0f0f0;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }
    select, input, button, textarea {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      font-size: 1em;
      box-sizing: border-box;
    }
    canvas {
      margin-top: 20px;
      border: 1px solid #ccc;
    }
    #qrResult {
      margin-top: 20px;
      text-align: center;
    }
  </style>
</head>
<body>
  <h1>ğŸ¨ ê³ ê¸‰ QR ì½”ë“œ ìƒì„±ê¸°</h1>
  <label for="qrType">QR ì½”ë“œ ìœ í˜• ì„ íƒ:</label>
  <select id="qrType" onchange="updateFields()">
    <option value="text">í…ìŠ¤íŠ¸ / URL</option>
    <option value="tel">ì „í™”ë²ˆí˜¸</option>
    <option value="sms">ë¬¸ì</option>
    <option value="mailto">ì´ë©”ì¼</option>
    <option value="wifi">Wi-Fi</option>
    <option value="geo">ìœ„ì¹˜</option>
    <option value="vcard">ëª…í•¨</option>
  </select>

  <div id="inputFields"></div>

  <label for="color">QR ì½”ë“œ ìƒ‰ìƒ:</label>
  <input type="color" id="color" value="#000000">

  <label for="bgColor">ë°°ê²½ ìƒ‰ìƒ:</label>
  <input type="color" id="bgColor" value="#ffffff">

  <label for="size">ì‚¬ì´ì¦ˆ (px):</label>
  <input type="number" id="size" value="256" min="100" max="1024">

  <label for="imgUpload">ê°€ìš´ë° ë¡œê³  ì´ë¯¸ì§€ (ì„ íƒ):</label>
  <input type="file" id="imgUpload" accept="image/*">

  <button onclick="generateAdvancedQR()">QR ì½”ë“œ ìƒì„±</button>
  <button onclick="downloadQR()">ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ</button>

  <div id="qrContainer"></div>

  <script>
    let qrCanvas = null;

    function updateFields() {
      const type = document.getElementById("qrType").value;
      const fields = document.getElementById("inputFields");
      let html = '';
      switch (type) {
        case "text":
          html = '<textarea id="text" placeholder="ë‚´ìš© ì…ë ¥"></textarea>';
          break;
        case "tel":
          html = '<input type="text" id="text" placeholder="ì „í™”ë²ˆí˜¸ ì…ë ¥ (ì˜ˆ: 01012345678)">';
          break;
        case "sms":
          html = '<input type="text" id="number" placeholder="ë°›ëŠ” ì‚¬ëŒ ë²ˆí˜¸">' +
                 '<input type="text" id="message" placeholder="ë©”ì‹œì§€ ë‚´ìš©">';
          break;
        case "mailto":
          html = '<input type="email" id="email" placeholder="ë°›ëŠ” ì‚¬ëŒ ì´ë©”ì¼">' +
                 '<input type="text" id="subject" placeholder="ì œëª©">' +
                 '<textarea id="body" placeholder="ë³¸ë¬¸ ë‚´ìš©"></textarea>';
          break;
        case "wifi":
          html = '<input type="text" id="ssid" placeholder="WiFi ì´ë¦„">' +
                 '<input type="text" id="password" placeholder="ë¹„ë°€ë²ˆí˜¸">' +
                 '<select id="encryption">
                    <option value="WPA">WPA/WPA2</option>
                    <option value="WEP">WEP</option>
                    <option value="">ì—†ìŒ</option>
                  </select>';
          break;
        case "geo":
          html = '<input type="text" id="lat" placeholder="ìœ„ë„">' +
                 '<input type="text" id="lng" placeholder="ê²½ë„">';
          break;
        case "vcard":
          html = '<input type="text" id="vname" placeholder="ì´ë¦„">' +
                 '<input type="text" id="vorg" placeholder="íšŒì‚¬">' +
                 '<input type="tel" id="vphone" placeholder="ì „í™”ë²ˆí˜¸">' +
                 '<input type="email" id="vemail" placeholder="ì´ë©”ì¼">' +
                 '<textarea id="vaddr" placeholder="ì£¼ì†Œ"></textarea>';
          break;
      }
      fields.innerHTML = html;
    }

    function generateAdvancedQR() {
      const type = document.getElementById("qrType").value;
      let data = '';

      switch (type) {
        case "text":
          data = document.getElementById("text").value;
          break;
        case "tel":
          data = 'tel:' + document.getElementById("text").value;
          break;
        case "sms":
          data = 'SMSTO:' + document.getElementById("number").value + ':' + document.getElementById("message").value;
          break;
        case "mailto":
          data = `mailto:${document.getElementById("email").value}?subject=${encodeURIComponent(document.getElementById("subject").value)}&body=${encodeURIComponent(document.getElementById("body").value)}`;
          break;
        case "wifi":
          const ssid = document.getElementById("ssid").value;
          const pwd = document.getElementById("password").value;
          const enc = document.getElementById("encryption").value;
          data = `WIFI:T:${enc};S:${ssid};P:${pwd};;`;
          break;
        case "geo":
          const lat = document.getElementById("lat").value;
          const lng = document.getElementById("lng").value;
          data = `geo:${lat},${lng}`;
          break;
        case "vcard":
          const name = document.getElementById("vname").value;
          const org = document.getElementById("vorg").value;
          const phone = document.getElementById("vphone").value;
          const email = document.getElementById("vemail").value;
          const addr = document.getElementById("vaddr").value;
          data = `BEGIN:VCARD\nVERSION:3.0\nFN:${name}\nORG:${org}\nTEL:${phone}\nEMAIL:${email}\nADR:${addr}\nEND:VCARD`;
          break;
      }

      const color = document.getElementById("color").value;
      const bgColor = document.getElementById("bgColor").value;
      const size = parseInt(document.getElementById("size").value);
      const imageFile = document.getElementById("imgUpload").files[0];
      const container = document.getElementById("qrContainer");
      container.innerHTML = "";

      const qr = new QRCode(container, {
        text: data,
        width: size,
        height: size,
        colorDark: color,
        colorLight: bgColor,
        correctLevel: QRCode.CorrectLevel.H
      });

      setTimeout(() => {
        const img = container.querySelector("img");
        const canvas = document.createElement("canvas");
        canvas.width = size;
        canvas.height = size;
        const ctx = canvas.getContext("2d");
        const qrImg = new Image();
        qrImg.crossOrigin = "Anonymous";
        qrImg.src = img.src;

        qrImg.onload = () => {
          ctx.drawImage(qrImg, 0, 0, size, size);
          if (imageFile) {
            const reader = new FileReader();
            reader.onload = (e) => {
              const logoImg = new Image();
              logoImg.src = e.target.result;
              logoImg.onload = () => {
                const logoSize = size * 0.2;
                const logoX = (size - logoSize) / 2;
                const logoY = (size - logoSize) / 2;
                ctx.beginPath();
                ctx.arc(size/2, size/2, logoSize/2 + 8, 0, Math.PI * 2);
                ctx.fillStyle = bgColor;
                ctx.fill();
                ctx.drawImage(logoImg, logoX, logoY, logoSize, logoSize);
                canvas.id = "qrCanvas";
                container.innerHTML = "";
                container.appendChild(canvas);
                qrCanvas = canvas;
              };
            };
            reader.readAsDataURL(imageFile);
          } else {
            canvas.id = "qrCanvas";
            container.innerHTML = "";
            container.appendChild(canvas);
            qrCanvas = canvas;
          }
        };
      }, 100);
    }

    function downloadQR() {
      if (!qrCanvas) {
        alert("ë¨¼ì € QR ì½”ë“œë¥¼ ìƒì„±í•˜ì„¸ìš”.");
        return;
      }
      const link = document.createElement("a");
      link.download = "qrcode.png";
      link.href = qrCanvas.toDataURL("image/png");
      link.click();
    }

    // ì´ˆê¸° ë¡œë”© ì‹œ í…ìŠ¤íŠ¸ ìœ í˜• í‘œì‹œ
    updateFields();
  </script>
</body>
</html>
