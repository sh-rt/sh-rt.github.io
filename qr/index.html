<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>고급 QR 코드 생성기</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
      max-width: 700px;
      margin: 50px auto;
      padding: 20px;
      background-color: #f0f0f0;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }
    select, input, button, textarea {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      font-size: 1em;
      box-sizing: border-box;
    }
    canvas {
      margin-top: 20px;
      border: 1px solid #ccc;
    }
    #qrResult {
      margin-top: 20px;
      text-align: center;
    }
  </style>
</head>
<body>
  <h1>🎨 고급 QR 코드 생성기</h1>
  <label for="qrType">QR 코드 유형 선택:</label>
  <select id="qrType" onchange="updateFields()">
    <option value="text">텍스트 / URL</option>
    <option value="tel">전화번호</option>
    <option value="sms">문자</option>
    <option value="mailto">이메일</option>
    <option value="wifi">Wi-Fi</option>
    <option value="geo">위치</option>
    <option value="vcard">명함</option>
  </select>

  <div id="inputFields"></div>

  <label for="color">QR 코드 색상:</label>
  <input type="color" id="color" value="#000000">

  <label for="bgColor">배경 색상:</label>
  <input type="color" id="bgColor" value="#ffffff">

  <label for="size">사이즈 (px):</label>
  <input type="number" id="size" value="256" min="100" max="1024">

  <label for="imgUpload">가운데 로고 이미지 (선택):</label>
  <input type="file" id="imgUpload" accept="image/*">

  <button onclick="generateAdvancedQR()">QR 코드 생성</button>
  <button onclick="downloadQR()">이미지 다운로드</button>

  <div id="qrContainer"></div>

  <script>
    let qrCanvas = null;

    function updateFields() {
      const type = document.getElementById("qrType").value;
      const fields = document.getElementById("inputFields");
      let html = '';
      switch (type) {
        case "text":
          html = '<textarea id="text" placeholder="내용 입력"></textarea>';
          break;
        case "tel":
          html = '<input type="text" id="text" placeholder="전화번호 입력 (예: 01012345678)">';
          break;
        case "sms":
          html = '<input type="text" id="number" placeholder="받는 사람 번호">' +
                 '<input type="text" id="message" placeholder="메시지 내용">';
          break;
        case "mailto":
          html = '<input type="email" id="email" placeholder="받는 사람 이메일">' +
                 '<input type="text" id="subject" placeholder="제목">' +
                 '<textarea id="body" placeholder="본문 내용"></textarea>';
          break;
        case "wifi":
          html = '<input type="text" id="ssid" placeholder="WiFi 이름">' +
                 '<input type="text" id="password" placeholder="비밀번호">' +
                 '<select id="encryption">
                    <option value="WPA">WPA/WPA2</option>
                    <option value="WEP">WEP</option>
                    <option value="">없음</option>
                  </select>';
          break;
        case "geo":
          html = '<input type="text" id="lat" placeholder="위도">' +
                 '<input type="text" id="lng" placeholder="경도">';
          break;
        case "vcard":
          html = '<input type="text" id="vname" placeholder="이름">' +
                 '<input type="text" id="vorg" placeholder="회사">' +
                 '<input type="tel" id="vphone" placeholder="전화번호">' +
                 '<input type="email" id="vemail" placeholder="이메일">' +
                 '<textarea id="vaddr" placeholder="주소"></textarea>';
          break;
      }
      fields.innerHTML = html;
    }

    function generateAdvancedQR() {
      const type = document.getElementById("qrType").value;
      let data = '';

      switch (type) {
        case "text":
          data = document.getElementById("text").value;
          break;
        case "tel":
          data = 'tel:' + document.getElementById("text").value;
          break;
        case "sms":
          data = 'SMSTO:' + document.getElementById("number").value + ':' + document.getElementById("message").value;
          break;
        case "mailto":
          data = `mailto:${document.getElementById("email").value}?subject=${encodeURIComponent(document.getElementById("subject").value)}&body=${encodeURIComponent(document.getElementById("body").value)}`;
          break;
        case "wifi":
          const ssid = document.getElementById("ssid").value;
          const pwd = document.getElementById("password").value;
          const enc = document.getElementById("encryption").value;
          data = `WIFI:T:${enc};S:${ssid};P:${pwd};;`;
          break;
        case "geo":
          const lat = document.getElementById("lat").value;
          const lng = document.getElementById("lng").value;
          data = `geo:${lat},${lng}`;
          break;
        case "vcard":
          const name = document.getElementById("vname").value;
          const org = document.getElementById("vorg").value;
          const phone = document.getElementById("vphone").value;
          const email = document.getElementById("vemail").value;
          const addr = document.getElementById("vaddr").value;
          data = `BEGIN:VCARD\nVERSION:3.0\nFN:${name}\nORG:${org}\nTEL:${phone}\nEMAIL:${email}\nADR:${addr}\nEND:VCARD`;
          break;
      }

      const color = document.getElementById("color").value;
      const bgColor = document.getElementById("bgColor").value;
      const size = parseInt(document.getElementById("size").value);
      const imageFile = document.getElementById("imgUpload").files[0];
      const container = document.getElementById("qrContainer");
      container.innerHTML = "";

      const qr = new QRCode(container, {
        text: data,
        width: size,
        height: size,
        colorDark: color,
        colorLight: bgColor,
        correctLevel: QRCode.CorrectLevel.H
      });

      setTimeout(() => {
        const img = container.querySelector("img");
        const canvas = document.createElement("canvas");
        canvas.width = size;
        canvas.height = size;
        const ctx = canvas.getContext("2d");
        const qrImg = new Image();
        qrImg.crossOrigin = "Anonymous";
        qrImg.src = img.src;

        qrImg.onload = () => {
          ctx.drawImage(qrImg, 0, 0, size, size);
          if (imageFile) {
            const reader = new FileReader();
            reader.onload = (e) => {
              const logoImg = new Image();
              logoImg.src = e.target.result;
              logoImg.onload = () => {
                const logoSize = size * 0.2;
                const logoX = (size - logoSize) / 2;
                const logoY = (size - logoSize) / 2;
                ctx.beginPath();
                ctx.arc(size/2, size/2, logoSize/2 + 8, 0, Math.PI * 2);
                ctx.fillStyle = bgColor;
                ctx.fill();
                ctx.drawImage(logoImg, logoX, logoY, logoSize, logoSize);
                canvas.id = "qrCanvas";
                container.innerHTML = "";
                container.appendChild(canvas);
                qrCanvas = canvas;
              };
            };
            reader.readAsDataURL(imageFile);
          } else {
            canvas.id = "qrCanvas";
            container.innerHTML = "";
            container.appendChild(canvas);
            qrCanvas = canvas;
          }
        };
      }, 100);
    }

    function downloadQR() {
      if (!qrCanvas) {
        alert("먼저 QR 코드를 생성하세요.");
        return;
      }
      const link = document.createElement("a");
      link.download = "qrcode.png";
      link.href = qrCanvas.toDataURL("image/png");
      link.click();
    }

    // 초기 로딩 시 텍스트 유형 표시
    updateFields();
  </script>
</body>
</html>
